<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<f:view>
    <h:head>
        <title>Bestellungstabelle</title>
        <link rel="stylesheet" type="text/css" href="css/table.css"/>
        <h:outputStylesheet library="primefaces" name="primeicons/primeicons.css"/>
    </h:head>
    <h:body>
        <h:form immediate="true">
            <div class="header">
                <h:commandButton action="homePage?faces-redirect=true" styleClass="homePage"/>
                <h:commandButton styleClass="button" value="Kunden" actionListener="#{customerController.incrementClicks}">
                    <f:ajax execute="@this" render="customersPanel"/>
                </h:commandButton>
                <h:panelGroup id="customersPanel">
                    <h:commandButton styleClass="panelGroup" value="Tabelle anzeigen" rendered="#{customerController.buttonDisplayed}"
                                     action="customerTable?faces-redirect=true" />
                    <h:commandButton styleClass="panelGroup" value="Neue Einträge erstellen" rendered="#{customerController.buttonDisplayed}"
                                     action="customerForm?faces-redirect=true" />
                </h:panelGroup>
                <h:commandButton styleClass="button" value="Produkte" actionListener="#{productController.incrementClicks}">
                    <f:ajax execute="@this" render="productesPanel"/>
                </h:commandButton>
                <h:panelGroup id="productesPanel">
                    <h:commandButton styleClass="panelGroup" value="Tabelle anzeigen" rendered="#{productController.buttonDisplayed}"
                                     action="productTable?faces-redirect=true" />
                    <h:commandButton styleClass="panelGroup" value="Neue Einträge erstellen" rendered="#{productController.buttonDisplayed}"
                                     action="productForm?faces-redirect=true" />
                </h:panelGroup>
                <h:commandButton styleClass="button" value="Bestellungen" actionListener="#{orderController.incrementClicks}">
                    <f:ajax execute="@this" render="ordersPanel"/>
                </h:commandButton>
                <h:panelGroup id="ordersPanel">
                    <h:commandButton styleClass="panelGroup" value="Tabelle anzeigen" rendered="#{orderController.buttonDisplayed}"
                                     action="orderTable?faces-redirect=true" />
                    <h:commandButton styleClass="panelGroup" value="Neue Einträge erstellen" rendered="#{orderController.buttonDisplayed}"
                                     action="orderForm?faces-redirect=true" />
                </h:panelGroup>
                <h:commandButton styleClass="button" value="BestellPositionen" actionListener="#{orderItemController.incrementClicks}">
                    <f:ajax execute="@this" render="orderItemsPanel"/>
                </h:commandButton>
                <h:panelGroup id="orderItemsPanel">
                    <h:commandButton styleClass="panelGroup" value="Tabelle anzeigen" rendered="#{orderItemController.buttonDisplayed}"
                                     action="orderItemTable?faces-redirect=true" />
                    <h:commandButton styleClass="panelGroup" value="Neue Einträge erstellen" rendered="#{orderItemController.buttonDisplayed}"
                                     action="orderItemForm?faces-redirect=true" />
                </h:panelGroup>
                <h:commandButton action="#{logout.logout}" styleClass="user"/>
            </div>
        </h:form>
        <h1>Bestellungen</h1>
<!--        <h:dataTable value="#{orderController.orders}" var="order" styleClass="order-table">-->
<!--            <h:column>-->
<!--                <f:facet name="header">Bestellstatus</f:facet>-->
<!--                #{order.oderStatus}-->
<!--            </h:column>-->
<!--            <h:column>-->
<!--                <f:facet name="header">Bestlldatum</f:facet>-->
<!--                <h:outputText value="#{order.orderDate}">-->
<!--                    <f:converter converterId="localDateConverter"/>-->
<!--                </h:outputText>-->
<!--            </h:column>-->
<!--            <h:column>-->
<!--                <f:facet name="header">Versanddatum</f:facet>-->
<!--                <h:outputText value="#{order.shippedDate}">-->
<!--                    <f:converter converterId="localDateConverter"/>-->
<!--                </h:outputText>-->
<!--            </h:column>-->
<!--            <h:column>-->
<!--                <f:facet name="header">Kunden-ID</f:facet>-->
<!--                #{order.customer.id}-->
<!--            </h:column>-->
<!--            <h:column>-->
<!--                <f:facet name="header">Geschäfts-ID</f:facet>-->
<!--                #{order.store.storeId}-->
<!--            </h:column>-->
<!--            <h:column>-->
<!--                <h:form>-->
<!--                    <h:commandButton styleClass="viewButton"/>-->
<!--                    <h:commandButton styleClass="deleteButton" action="#{orderController.deleteOrderRecord(order)}"/>-->
<!--                </h:form>-->
<!--            </h:column>-->
<!--        </h:dataTable>-->


        <h:form id="orderForm">
            <p:dataTable value="#{orderController.orders}" var="order" styleClass="order-table" widgetVar="orderTable" id="orderTable" >
                <p:column headerText="Bestellstatus" >
                    #{order.orderStatus}
                </p:column>
                <p:column headerText="Bestelldatum">
                    <h:outputText value="#{order.orderDate}">
                        <f:converter converterId="localDateConverter"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="Versanddatum">
                    <h:outputText value="#{order.shippedDate}">
                        <f:converter converterId="localDateConverter"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="Kunden-ID" filterBy="#{order.customer.id}" filterMatchMode="contains">
                    #{order.customer.id}
                </p:column>
                <p:column headerText="Geschäfts-ID">
                    #{order.store.storeId}
                </p:column>
                <p:column headerText="Aktionen">

                        <p:commandButton  icon="pi pi-search" action="#{orderController.selectOrder(order)}" oncomplete="PF('orderDialog').show()" process="@this" update=":orderForm:orderDetails"/>
                    <p:commandButton  icon="pi pi-pencil"
                                     action="#{orderController.selectOrder(order)}"
                                     oncomplete="PF('editOrderDialog').show()"
                                     process="@this"
                                     update=":orderForm:editOrderDetails"/>
                    <p:commandButton  icon="pi pi-trash" action="#{orderController.deleteOrderRecord(order)}" update=":orderForm:orderTable, :messageForm"/>

                </p:column>
            </p:dataTable>

            <p:dialog header="Order Details" widgetVar="orderDialog" modal="true" resizable="false" width="400" dynamic="true" id="orderDetails" >
                <h:form >
                <h:panelGrid columns="2" cellpadding="4" >
                    <h:outputLabel value="Bestellung-ID :" />
                    <h:outputText value="#{orderController.selectedOrder.id}" />

                    <h:outputLabel value="Bestellung Status:" />
                    <h:outputText value="#{orderController.selectedOrder.orderStatus}" />

                    <h:outputLabel value="BestellungsDatum:" />
                    <h:outputText value="#{orderController.selectedOrder.orderDate}">
                        <f:converter converterId="localDateConverter"/>
                    </h:outputText>

                    <h:outputLabel value="Versanddatum:" />
                    <h:outputText value="#{orderController.selectedOrder.shippedDate}">
                        <f:converter converterId="localDateConverter"/>
                    </h:outputText>

                    <h:outputLabel value="Erwartetes datum:" />
                    <h:outputText value="#{orderController.selectedOrder.requiredDate}">
                        <f:converter converterId="localDateConverter"/>
                    </h:outputText>

                    <h:outputLabel value="Kunden-ID:" />
                    <h:outputText value="#{orderController.selectedOrder.customer.id}" />

                    <h:outputLabel value="Mitarbeiter-ID:" />
                    <h:outputText value="#{orderController.selectedOrder.staff.staffId}" />

                    <h:outputLabel value="Geschäft-ID:" />
                    <h:outputText value="#{orderController.selectedOrder.store.storeId}" />
                </h:panelGrid>
                </h:form>
            </p:dialog>

            <p:dialog header="Edit Order" widgetVar="editOrderDialog" modal="true" resizable="false" width="400" dynamic="true" id="editOrderDetails">
                <h:form  prependId="false">
                    <h:panelGrid columns="2" cellpadding="4" >
                        <h:outputLabel value="Bestellung-ID :" />
                        <h:outputText value="#{orderController.selectedOrder.id}" />

                        <h:outputLabel value="Bestellung Status:" />
                        <p:inputText value="#{orderController.selectedOrder.orderStatus}" />

                        <h:outputLabel value="BestellungsDatum:" />
                        <p:calendar value="#{orderController.selectedOrder.orderDate}" pattern="dd.MM.yyyy" locale="de"/>

                        <h:outputLabel value="Versanddatum:" />
                        <p:calendar value="#{orderController.selectedOrder.shippedDate}" pattern="dd.MM.yyyy" locale="de"/>

                        <h:outputLabel value="Erwartetes datum:" />
                        <p:calendar value="#{orderController.selectedOrder.requiredDate}" pattern="dd.MM.yyyy" locale="de"/>

                        <h:outputLabel value="Kunden-ID:" />
                        <h:outputText value="#{orderController.selectedOrder.customer.id}" />

                        <h:outputLabel value="Mitarbeiter-ID:" />
                        <h:outputText value="#{orderController.selectedOrder.staff.staffId}" />

                        <h:outputLabel value="Geschäft-ID:" />
                        <h:outputText value="#{orderController.selectedOrder.store.storeId}" />


                    </h:panelGrid>
                    <p:commandButton value="Save" process="@this" action="#{orderController.saveOrder()}" update=":orderForm:orderTable, :messageForm, :orderForm:editOrderDetails" oncomplete="PF('editOrderDialog').hide()"/>

                </h:form>

            </p:dialog>

        </h:form>
        <h:form id="messageForm">
            <p:messages globalOnly="true" showDetail="true" showSummary="true" autoUpdate="true" />

        </h:form>
        <h:form styleClass="button-container">
            <h:outputLabel value="Insgesamt #{orderController.totalRecords} Einträge"/>
            <h:selectOneMenu styleClass="select" value="#{orderController.pageSize}">
                <f:selectItem itemValue="5" itemLabel="5 Einträge/Seite"/>
                <f:selectItem itemValue="10" itemLabel="10 Einträge/Seite"/>
                <f:selectItem itemValue="20" itemLabel="20 Einträge/Seite"/>
                <f:selectItem itemValue="50" itemLabel="50 Einträge/Seite"/>
                <f:ajax event="change" execute="@this" render="@all"/>
            </h:selectOneMenu>
            <div class="pagination">
                <h:commandButton styleClass="firstPage" action="#{orderController.firstPage}"
                                 disabled="#{orderController.currentPage == 1}"/>
                <h:commandButton styleClass="previous" action="#{orderController.prevPage}"
                                 disabled="#{orderController.currentPage == 1}"/>
                <ui:repeat value="#{orderController.pageNumbers}" var="pageNum">
                    <h:commandLink styleClass="repeat" value="#{pageNum}" action="#{orderController.setPage(pageNum)}"
                                   rendered="#{pageNum != orderController.currentPage}"/>
                    <h:outputText styleClass="current" value="#{pageNum} "
                                  rendered="#{pageNum == orderController.currentPage}"/>
                </ui:repeat>
                <h:outputText styleClass="rest" value="..."
                              rendered="#{orderController.currentPage + 3 lt orderController.totalPages}"/>
                <h:commandButton styleClass="next" action="#{orderController.nextPage}"
                                 disabled="#{orderController.currentPage == orderController.totalPages}"/>
                <h:commandButton styleClass="lastPage" action="#{orderController.lastPage}"
                                 disabled="#{orderController.currentPage == orderController.totalPages}"/>
            </div>
            <div class="goto">
                <h:outputLabel value="Zur Seite"/>
                <h:inputText styleClass="text" value="#{orderController.currentPage}" size="3"/>
                <h:commandButton value="Gehen" action="#{orderController.goToPage}"/>
            </div>
        </h:form>
        <div style="height: 40px; display: flex; align-items: center; justify-content: space-between; margin-top: 30px; background-color: #f2f2f2;">
            <div style="margin: 15px;">&copy; Bike Store</div>
            <div style="margin: 15px;">Gruppe 10 - Software Engineering Projekt SS2024</div>
        </div>
    </h:body>
</f:view>
</html>